<!DOCTYPE html>
<html lang="en">
	<head>
		<script src="../forge/all.js"></script>
		<script src="js/jquery-1.7.2.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<link href="css/bootstrap.css" rel="stylesheet">
		<link href="css/bootstrap-responsive.css" rel="stylesheet">
		<script>
            
//*************************************FORM ASSIST*****************************************

//            forge.internal.call(
//                                'kill_form_assist.killBar',
//                                {text: ""},
//                                function () { alert('Success!') },
//                                function (e) { alert('Error: '+e.message)}
//                                )
            
//*************************************DATABASE********************************************
            
//            var callAsync = function (toCalls) {
//                if(toCalls.length){
//                    toCall = toCalls[0];
//                    forge.internal.call('database.'+toCall.string,
//                                        toCall.args,
//                                        function(success){
//                                        toCall.success(success);
//                                        callAsync(toCalls.slice(1));
//                                        },toCall.error)
//                }
//            }
//            
//            callAsync([
//                {
//                       string: 'createTables',
//                       args: {schema:[
//                                      {name:"Poo", schema: "(identification INTEGER PRIMARY KEY, poop TEXT)"},
//                                      {name: "Woot", schema: "(wootLevel INTEGER, wootName TEXT, age TEXT)"}
//                                      ]},
//                       success: function(){alert("Yay created tables");}
//                       },
//                       {
//                       string: 'writeAll',
//                       args: {queries:[
//                                       {query:"insert into Poo (poop) values (?)", text:"wooot woo"}//,
//                                       //{query:"insert into Woot (wootLevel, wootName, age) values (69, ?, 'old')", text: "wooty"}
//                                       ]},
//                       success: function(ids){alert(ids);}
//                       },
//                       {
//                       string: 'wipe',
//                       args:{},
//                       success: function(){alert("yay dropped tables");},
//                       error: function(e){
//                       alert("Shit an error");
//                       console.log(e);
//                       }
//                }
//            ]
//            )

            // Create Tables
            var CREATE_TABLES = (function() {
                                 var COLUMN, CREATE, ENTITY_COLS, LOC_COL, LOC_ID, SCHEMA, SERV_COL, STATUS_COL, TABLE_NAMES, TEXT_COL, TIME_COL, i, schema;
                                 CREATE = "CREATE TABLE ";
                                 TEXT_COL = "text";
                                 LOC_COL = "local_id";
                                 SERV_COL = "server_id";
                                 TIME_COL = "last_updated";
                                 STATUS_COL = "sync_status";
                                 TABLE_NAMES = ["Notes", "NoteTags", "NoteContacts", "NoteURL", "NoteEmail"];
                                 ENTITY_COLS = ["hashtag", "attag", "email", "url"];
                                 LOC_ID = "" + LOC_COL + " INTEGER PRIMARY KEY ";
                                 SCHEMA = [("(" + TEXT_COL + " TEXT, " + LOC_ID + ", " + SERV_COL + " TEXT UNIQUE,") + (" " + TIME_COL + " TEXT, " + STATUS_COL + " TEXT)")].concat((function() {
                                                                                                                                                                                     var _i, _len, _results;
                                                                                                                                                                                     _results = [];
                                                                                                                                                                                     for (_i = 0, _len = ENTITY_COLS.length; _i < _len; _i++) {
                                                                                                                                                                                     COLUMN = ENTITY_COLS[_i];
                                                                                                                                                                                     _results.push("(" + LOC_COL + " INTEGER, " + COLUMN + " TEXT)");
                                                                                                                                                                                     }
                                                                                                                                                                                     return _results;
                                                                                                                                                                                     })());
                                 return (function() {
                                         var _i, _len, _results;
                                         _results = [];
                                         for (i = _i = 0, _len = SCHEMA.length; _i < _len; i = ++_i) {
                                         schema = SCHEMA[i];
                                         _results.push({
                                                       name: TABLE_NAMES[i],
                                                       schema: schema
                                                       });
                                         }
                                         return _results;
                                         })();
                                 })()
            
            // Test create table
//            forge.internal.call(
//                                'database.createTables',
//                                {schema: CREATE_TABLES},
//                                function () { alert('Success') },
//                                function (e) { alert('Error' + e.message)}
//                                )
            
            // WriteAll takes an array of JSON objects with one attribute called query(string)
//            forge.internal.call(
//                                'database.createTables',
//                                {schema: CREATE_TABLES},
//                                function () { alert('Success') },
//                                function (e) { alert('Error' + e.message)}
//                                )
            
            // Drop all the tables
//            forge.internal.call(
//                                'database.dropTables',
//                                {tables: ["Notes", "NoteTags", "NoteContacts", "NoteURL", "NoteEmail"]},
//                                function () { alert('Success')},
//                                function (e) { alert('Error' + e.message)}
//                                )
            
//*************************************OLD DATABASE*********************************************
            
            // Single insert test
//            forge.internal.call(
//                                'database.writeAll',
//                                {queries: "insert into Notes (text,html,server_id,last_updated,sync_status) values ('value1611','value1511','value1411','value1311','value1211')"},
//                                function () { alert('Success!') },
//                                function (e) { alert('Error: '+e.message)}
//                                )
            
            // database query test
//            forge.internal.call(
//                                'database.query',
//                                {text: "select * from Notes  order by last_updated desc  limit 0,25;"},
//                                function () { alert('Success!') },
//                                function (e) { alert('Error: '+e.message)}
//                                )
            
            
//            // Multiple insert test
//            forge.internal.call(
//                                'database.writeAll',
//                                {queries: ["insert into Notes (text,html,server_id,last_updated,sync_status) values ('value66122','value15522','valu1e4422','val1ue3322','v1alue2222')", "insert into Notes (text,html,server_id,last_updated,sync_status) values ('value66133','value55133','value44331','value33133','value21221')"]},
//                                function () { alert('Success!') },
//                                function (e) { alert('Error: '+e.message)}
//                                )

            // Update and Insert query
//            forge.internal.call(
//                                'database.writeAll',
//                                {queries: ["update Notes set text='va2l0', html='val21',server_id='va2l2',last_updated='va2l3', sync_status='v2al4' where local_id='local_id2_lulz'", "delete from Notes where local_id = 20", "insert into Notes (text,html,server_id,last_updated,sync_status) values ('poop','poobar','pooville','pootan','poofoo')"]},
//                                function () { alert('Success!') },
//                                function (e) { alert('Error: '+e.message)}
//                                )
            
            
            // Multiple inserts per single query - doesn't need to support
//            forge.internal.call(
//                                'database.cudQuery',
//                                {text: "insert into Notes (text,html,server_id,last_updated,sync_status) values ('test11','test22','test33','test33.5','test44.5'), ('test44','test55','test66','test66.5','test77.5'), ('test77','test88','test99','test99.5','test110.5')"},
//                                function () { alert('Success!') },
//                                function (e) { alert('Error: '+e.message)}
//                                )
            
            
            
//*************************************BOILERPLATE*********************************************
            
//			forge.internal.addEventListener("alert.resume", function () {
//				alert("Weclome back!");
//			});
//		
//			$(function () {
//				forge.internal.call('inspector.list', {}, function (methods) {
//					var modules = {};
//					for (method in methods) {
//						var parts = method.split('.');
//						apimethod = parts.pop();
//						var module = parts.join('.');
//						if (!modules[module]) {
//							modules[module] = {};
//						}
//						modules[module][apimethod] = methods[method];
//					}
//					for (module in modules) {
//						$('#_module').append('<option>'+module+'</option>');
//					}
//					$('#_module').change(function () {
//						var methods = modules[$(this).val()]; 
//						$('#_method').html('');
//						for (method in methods) {
//							$('#_method').append('<option>'+method+'</option>');
//						}
//						$('#_method').change();
//					})
//					$('#_module').change();
//					$('#_method').change(function () {
//						var module = $('#_module').val();
//						var method = $(this).val(); 
//						var params = modules[module][method];
//						$('.api_input').detach();
//						for (param in params) {
//							$('#_actions').before('<div class="control-group api_input"><label class="control-label" for="'+param+'">'+param+'</label><div class="controls"><input type="text" class="input-xlarge" id="'+param+'"></div></div>');
//						}
//					})
//					$('#_method').change();
//					$('#_run').click(function () {
//						var module = $('#_module').val();
//						var method = $('#_method').val();
//						var params = {};
//						
//						$('.api_input input').each(function (i, x) {
//							params[$(x).attr('id')] = $(x).val();
//						});
//						
//						$('#_output').prepend('<pre class="alert alert-info">Called "'+module+'.'+method+'" with "'+JSON.stringify(params, null, '')+'"</pre>');
//						forge.internal.call(module+'.'+method, params, function () {
//							$('#_output').prepend('<pre class="alert alert-success">Success for "'+module+'.'+method+'" with "'+JSON.stringify(arguments[0], null, '')+'"</pre>');
//						}, function () {
//							$('#_output').prepend('<pre class="alert alert-error">Error for "'+module+'.'+method+'" with "'+JSON.stringify(arguments[0], null, '')+'"</pre>');
//						})
//					});
//				}, function () {
//					alert("Error");
//				});
//				forge.internal.addEventListener('*', function (event, e) {
//					if (event == 'inspector.eventTriggered') {
//						$('#_output').prepend('<pre class="alert alert-warning">Native event triggered "'+e.name+'"</pre>');
//					} else if (event == 'inspector.eventInvoked') {
//						if (e['class'] == 'ForgeEventListener') {
//							$('#_output').prepend('<pre class="alert alert-warning">Default event listener for "'+e.name+'" called</pre>');
//						} else {
//							$('#_output').prepend('<pre class="alert alert-warning">Calling event listener "'+e.name+'" in class "'+e['class']+'"</pre>');
//						}
//					} else {
//						$('#_output').prepend('<pre class="alert alert-warning">Javascript event "'+event+'" triggered with data "'+JSON.stringify(e)+'"</pre>');
//					}
//				});
//			});
		</script>
	</head>
	<body>
		<div class="container">
			<div class="page-header">
				<h1>INPUT  <small>choose an API call to DOIT</small></h1>
			</div>
			<div class="form-horizontal">
					<div class="control-group">
						<label class="control-label" for="_module">Module</label>
						<div class="controls">
							<select id="_module">
							</select>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="_method">Method</label>
						<div class="controls">
							<select id="_method">
							</select>
						</div>
					</div>
					<div class="form-actions" id="_actions">
						<button type="submit" class="btn btn-primary" id="_run">Run!</button>
					</div>
			</div>
			<div class="page-header">
				<h1>Output <small>results from the API call, most recent at the top</small></h1>
			</div>
			<div id="_output">
			</div>
		</div>
	</body>
</html>
